\begin{frame}{Evaluation}{Les possibilites existantes}
    \begin{itemize}[<+->]
        \item Via un \texttt{callback} ou \texttt{thunk}
        \item Via un iterateur
    \end{itemize}
\end{frame}

\begin{frame}[fragile]{Evaluation traditionnelle}{Par defaut en PHP}
    \begin{lstlisting}[firstnumber=1]
        <?php

        $var = 'foobar';
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Evaluation traditionnelle}{Par defaut en PHP}
    \begin{lstlisting}[firstnumber=1]
        <?php

        $var = range(0, 1000 ** 3);
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Evaluation traditionnelle}{Par defaut en PHP}
    \begin{spverbatim}
        PHP Fatal error: Allowed memory size of 536870912 bytes exhausted (tried to allocate 34359738376 bytes) in example.php on line 5
    \end{spverbatim}
\end{frame}

\begin{frame}[fragile]{Evaluation paresseuse}{Via un \texttt{callback} ou \texttt{thunk}}
    \begin{lstlisting}[firstnumber=1]
        <?php

        $array = static fn(): array => range(0, 1000 ** 3);
    \end{lstlisting}
\end{frame}

\begin{frame}{Evaluation paresseuse}{Un \texttt{thunk}}
    \begin{itemize}[<+->]
        \item Un \texttt{thunk} est un \texttt{callback} avec une plus value
        sémantique en terme de précision.
        \item Un \textit{thunk} est l'expression d'une valeur qui est en attente
        d'evaluation.
        \item Un \textit{thunk} est une function qui enrobe (\texttt{wrap}) une
        expression, pour postposer son evaluation.
        \item L'origine du terme est né comme une version humoristique du passé
        du verbe anglophone \textit{penser} (\textit{to think}).
    \end{itemize}
\end{frame}

\begin{frameC}{Oui, mais\ldots}

\end{frameC}

\begin{frame}[fragile]{Evaluation paresseuse}{Via un \texttt{callback} ou \texttt{thunk}}
    \begin{lstlisting}[firstnumber=1]
        <?php

        $array = static fn(): array => range(0, 1000 ** 3);
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Evaluation paresseuse}{Via un \texttt{callback} ou \texttt{thunk}}
    \begin{spverbatim}
        PHP Fatal error: Allowed memory size of 536870912 bytes exhausted (tried to allocate 34359738376 bytes) in example.php on line 5
    \end{spverbatim}
\end{frame}

\begin{frame}[fragile]{Evaluation paresseuse}{Via un \texttt{callback} ou \texttt{thunk}}
    \includegraphics[width=\textwidth]{meme/wtf.png}
\end{frame}

\begin{frame}{Evaluation paresseuse}{Un \texttt{thunk}}
    \begin{itemize}[<+->]
        \item Ne retourne qu'une seule valeur
    \end{itemize}
\end{frame}

\begin{frameC}{Et pour les collections alors ?}

\end{frameC}

\begin{frame}{Evaluation paresseuse}{Les iterateurs}
    \begin{itemize}[<+->]
        \item Les iterateurs
        \item Les generateurs
    \end{itemize}
\end{frame}

\begin{frame}[fragile]{Evaluation paresseuse}{Via un iterateur}
    \begin{lstlisting}[firstnumber=1]
        <?php

        function xrange($start, $end, $step = 1): Generator {
            for ($i = $start; $i <= $end; $i += $step) {
                yield $i;
            }
        }

        foreach (xrange(0, 1000 ** 3) as $value) {
            // Do stuff
        }
    \end{lstlisting}
\end{frame}

\begin{frame}{Schemas}{Evaluation traditionnelle}
    \newcolumntype{t}{>{\tt}c}
        \begin{center}
            \[
            \left[ \begin{array}{tt}
                0 \Rightarrow a \\
                1 \Rightarrow b \\
                2 \Rightarrow a
            \end{array} \right]
            \pause
            \xrightarrow{\texttt{array\_flip()}}
            \left[ \begin{array}{tt}
                a \Rightarrow 2 \\
                b \Rightarrow 1
            \end{array} \right]
            \pause
            \xrightarrow{\texttt{array\_flip()}}
            \left[ \begin{array}{tt}
                2 \Rightarrow a \\
                1 \Rightarrow b
            \end{array} \right]
            \]%
    \end{center}
\end{frame}

\begin{frame}{Schemas}{Evaluation traditionnelle}
    \newcolumntype{t}{>{\tt}c}
    \begin{center}
            \[
            \left[ \begin{array}{tt}
                0 \Rightarrow \left[ \begin{array}{tt} a \Rightarrow A\end{array} \right] \\
                1 \Rightarrow \left[ \begin{array}{tt} b \Rightarrow B\end{array} \right] \\
                2 \Rightarrow \left[ \begin{array}{tt} c \Rightarrow C\end{array} \right]
            \end{array} \right]
            \pause
            \xrightarrow{\texttt{array\_flip()}}
            \raisebox{-.5\height}{\includegraphics[scale=0.05]{meme/No-RageFace.jpg}}
            \]%
            \texttt{Fatal error: Uncaught TypeError: Illegal offset type}
    \end{center}
\end{frame}

\input{schema-lazy-eval.tex}
